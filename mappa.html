<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Mappa Satellitare TLC 2025</title>
    <!-- 1. CSS di Leaflet (Sempre PRIMA degli script) -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        /* IMPORTANTE: Senza altezza la mappa sparisce */
        #map { 
            height: 550px; 
            width: 100%; 
            border-radius: 12px; 
            border: 2px solid #007bff; 
            margin-top: 15px;
            background: #f0f0f0; /* Grigio di sfondo se la mappa non carica */
        }
        body { font-family: sans-serif; margin: 20px; background: #fafafa; }
        .controls { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        input { padding: 8px; margin: 5px; border: 1px solid #ccc; border-radius: 4px; }
        button { padding: 10px 15px; cursor: pointer; border: none; border-radius: 4px; font-weight: bold; }
        .btn-add { background: #007bff; color: white; }
        .btn-geo { background: #28a745; color: white; }
    </style>
</head>
<body>

    <div class="controls">
        <h3>üìç Controllo POI - Visualizzazione 2025</h3>
        <input type="text" id="poiName" placeholder="Nome (es. SEM1)">
        <input type="text" id="lat" placeholder="Latitudine">
        <input type="text" id="lng" placeholder="Longitudine">
        <br>
        <button class="btn-geo" onclick="rilevaPosizione()">üìç Rileva mia posizione</button>
        <button class="btn-add" onclick="aggiungiPunto()">Aggiungi sulla Mappa</button>
    </div>

    <!-- Il contenitore della mappa -->
    <div id="map"></div>

    <!-- 2. JavaScript di Leaflet (Sempre DOPO il CSS) -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script>
    // Mappa Stradale
    var stradale = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap'
    });

    // Mappa Satellitare (Google - Solitamente pi√π stabile)
    var satellite = L.tileLayer('https://{s}{x}&y={y}&z={z}', {
        maxZoom: 20,
        subdomains: ['mt0', 'mt1', 'mt2', 'mt3'],
        attribution: '&copy; Google Maps Satellite'
    });

    var map = L.map('map', {
        center: [41.8719, 12.5674],
        zoom: 6,
        layers: [stradale] 
    });

    var baseMaps = {
        "Mappa Stradale": stradale,
        "Satellite": satellite
    };

    L.control.layers(baseMaps).addTo(map);

    var markers = {};

    function rilevaPosizione() {
        if (!navigator.geolocation) { alert("GPS non supportato."); return; }
        navigator.geolocation.getCurrentPosition(function(p) {
            document.getElementById('lat').value = p.coords.latitude.toFixed(6);
            document.getElementById('lng').value = p.coords.longitude.toFixed(6);
        }, function(e) { alert("Errore GPS: " + e.message); });
    }

    function aggiungiPunto() {
        var lat = document.getElementById('lat').value;
        var lng = document.getElementById('lng').value;
        var nome = document.getElementById('poiName').value || "POI";
        if (lat && lng) {
            if (markers[nome]) map.removeLayer(markers[nome]);
            markers[nome] = L.marker([lat, lng]).addTo(map).bindPopup(nome).openPopup();
            map.setView([lat, lng], 15);
        }
    }
</script>

</body>
</html>

