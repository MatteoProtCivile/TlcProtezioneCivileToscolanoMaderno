<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TLC - Protezione Civile Toscolano Maderno</title>

    <!-- Leaflet CSS (Necessario per i pulsanti zoom e la visualizzazione) -->
    <link rel="stylesheet" href="unpkg.com" />
    
    <style>
        /* Struttura Pagina */
        html, body { 
            height: 100%; 
            margin: 0; 
            display: flex; 
            flex-direction: column; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f0f0;
        }

        /* Header (Testata in alto) */
        .pc-header {
            background-color: #003399; 
            color: white; 
            padding: 15px 20px;
            border-bottom: 4px solid #ffcc00;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 1000;
        }

        .pc-header h1 { 
            margin: 0; 
            font-size: 1.2rem; 
            text-transform: uppercase; 
            letter-spacing: 1px;
        }

        /* Area Controlli */
        .controls {
            background: white;
            padding: 10px;
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            justify-content: center;
            border-bottom: 1px solid #ccc;
        }

        input { padding: 8px; border: 1px solid #ccc; border-radius: 4px; }
        button { 
            padding: 8px 15px; 
            cursor: pointer; 
            border: none; 
            border-radius: 4px; 
            font-weight: bold; 
            transition: 0.3s;
        }

        .btn-gps { background-color: #ffcc00; color: #003399; }
        .btn-add { background-color: #003399; color: white; }
        button:hover { opacity: 0.8; }

        /* Contenitore Mappa (si espande per riempire lo spazio) */
        #map { 
            flex-grow: 1; 
            width: 100%; 
            background: #cbdbe5;
        }

        /* Footer (Pi√® di pagina) */
        .pc-footer {
            background-color: #003399; 
            color: white; 
            padding: 8px 20px;
            border-top: 2px solid #ffcc00;
            text-align: center;
            font-size: 0.85rem;
            z-index: 1000;
        }

        .pc-footer span { opacity: 0.9; }
    </style>
</head>
<body>

    <!-- Header Superiore -->
    <header class="pc-header">
        <h1>Protezione Civile Toscolano Maderno - Reparto TLC</h1>
    </header>

    <!-- Pannello Input -->
    <div class="controls">
        <input type="text" id="nomePunto" placeholder="ID Radio / Unit√†">
        <input type="number" id="lat" placeholder="Latitudine" step="any">
        <input type="number" id="lng" placeholder="Longitudine" step="any">
        <button class="btn-gps" onclick="rilevaPosizione()">üìç RILEVA POSIZIONE</button>
        <button class="btn-add" onclick="aggiungiPunto()">AGGIUNGI PUNTO</button>
    </div>

    <!-- Mappa -->
    <div id="map"></div>

    <!-- Footer Inferiore -->
    <footer class="pc-footer">
        <span>Versione 2025 | Creatore: Matteo Podavini &reg;</span>
    </footer>

    <!-- Leaflet JS -->
    <script src="unpkg.com"></script>

    <script>
        // Inizializzazione Mappa
        var map = L.map('map', {
            center: [45.6415, 10.6083], 
            zoom: 13,
            zoomControl: true // Pulsanti + e - attivi
        });

        // Layer Mappa Stradale
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '¬© OpenStreetMap'
        }).addTo(map);

        // Funzione GPS
        function rilevaPosizione() {
            if (!navigator.geolocation) {
                alert("GPS non supportato dal browser.");
                return;
            }
            navigator.geolocation.getCurrentPosition(function(pos) {
                const lt = pos.coords.latitude.toFixed(6);
                const lg = pos.coords.longitude.toFixed(6);
                document.getElementById('lat').value = lt;
                document.getElementById('lng').value = lg;
                map.setView([lt, lg], 16);
                L.marker([lt, lg]).addTo(map).bindPopup("Posizione Attuale").openPopup();
            }, function(err) {
                alert("Errore GPS: " + err.message);
            });
        }

        // Funzione Aggiungi Punto
        function aggiungiPunto() {
            const nome = document.getElementById('nomePunto').value || "Unit√† TLC";
            const lat = parseFloat(document.getElementById('lat').value);
            const lng = parseFloat(document.getElementById('lng').value);

            if (!isNaN(lat) && !isNaN(lng)) {
                L.marker([lat, lng]).addTo(map)
                    .bindPopup("<b>" + nome + "</b><br>Coordinate: " + lat + ", " + lng)
                    .openPopup();
                map.flyTo([lat, lng], 15);
            } else {
                alert("Inserire coordinate valide.");
            }
        }

        // Fix visualizzazione per caricamento dinamico
        window.onload = function() {
            setTimeout(function() {
                map.invalidateSize();
            }, 500);
        };
    </script>
</body>
</html>
