<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Mappa Interattiva POI 2025</title>
    <link rel="stylesheet" href="unpkg.com" />
    <style>
        #map { height: 500px; width: 100%; border-radius: 8px; margin-top: 10px; }
        .controls { background: #f4f4f4; padding: 15px; border-radius: 8px; font-family: sans-serif; }
        input { margin: 5px; padding: 5px; border: 1px solid #ccc; border-radius: 4px; }
        button { padding: 6px 12px; cursor: pointer; border: none; border-radius: 4px; margin: 5px; }
        .btn-add { background: #007bff; color: white; }
        .btn-geo { background: #28a745; color: white; } /* Verde per la posizione */
    </style>
</head>
<body>

    <div class="controls">
        <h3>Gestione POI</h3>
        <input type="text" id="lat" placeholder="Latitudine">
        <input type="text" id="lng" placeholder="Longitudine">
        <input type="text" id="poiName" placeholder="Nome (es. SEM1 o PC)">
        
        <br>
        <!-- Pulsante per rilevare la posizione del PC -->
        <button class="btn-geo" onclick="rilevaPosizione()">üìç Rileva la mia posizione</button>
        <!-- Pulsante per aggiungere alla mappa -->
        <button class="btn-add" onclick="aggiungiPunto()">Aggiungi sulla Mappa</button>
    </div>

    <div id="map"></div>

    <script src="unpkg.com"></script>
    <script>
        var map = L.map('map').setView([41.8719, 12.5674], 6);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);

        var markers = {}; // Usiamo un oggetto per gestire pi√π punti (es. SEM1, SEM2, PC)

        // FUNZIONE PER RILEVARE LA POSIZIONE DEL PC
        function rilevaPosizione() {
            if (!navigator.geolocation) {
                alert("Il tuo browser non supporta la geolocalizzazione.");
                return;
            }

            navigator.geolocation.getCurrentPosition(function(position) {
                // Inserisce i dati rilevati nei campi input
                document.getElementById('lat').value = position.coords.latitude.toFixed(6);
                document.getElementById('lng').value = position.coords.longitude.toFixed(6);
                // Suggerisce un nome predefinito se vuoto
                if(!document.getElementById('poiName').value) {
                    document.getElementById('poiName').value = "Mia Posizione";
                }
                alert("Posizione rilevata con successo!");
            }, function(error) {
                alert("Errore nel rilevamento: " + error.message);
            });
        }

        // FUNZIONE PER AGGIUNGERE IL PUNTO (MANUALE O RILEVATO)
        function aggiungiPunto() {
            var lat = document.getElementById('lat').value;
            var lng = document.getElementById('lng').value;
            var nome = document.getElementById('poiName').value || "Nuovo Punto";

            if (lat && lng) {
                // Se esiste gi√† un marker con lo stesso nome, lo rimuoviamo per aggiornarlo
                if (markers[nome]) map.removeLayer(markers[nome]);

                // Crea il nuovo marker e lo aggiunge alla collezione
                markers[nome] = L.marker([lat, lng]).addTo(map)
                    .bindPopup("<b>" + nome + "</b>")
                    .openPopup();
                
                map.setView([lat, lng], 15); // Zoom pi√π ravvicinato
            } else {
                alert("Inserisci coordinate o usa il tasto Rileva.");
            }
        }
    </script>
</body>
</html>
