<script>
    // Mappa Stradale
    var stradale = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap'
    });

    // Mappa Satellitare (Google - Solitamente pi√π stabile)
    var satellite = L.tileLayer('https://{s}{x}&y={y}&z={z}', {
        maxZoom: 20,
        subdomains: ['mt0', 'mt1', 'mt2', 'mt3'],
        attribution: '&copy; Google Maps Satellite'
    });

    var map = L.map('map', {
        center: [41.8719, 12.5674],
        zoom: 6,
        layers: [stradale] 
    });

    var baseMaps = {
        "Mappa Stradale": stradale,
        "Satellite": satellite
    };

    L.control.layers(baseMaps).addTo(map);

    var markers = {};

    function rilevaPosizione() {
        if (!navigator.geolocation) { alert("GPS non supportato."); return; }
        navigator.geolocation.getCurrentPosition(function(p) {
            document.getElementById('lat').value = p.coords.latitude.toFixed(6);
            document.getElementById('lng').value = p.coords.longitude.toFixed(6);
        }, function(e) { alert("Errore GPS: " + e.message); });
    }

    function aggiungiPunto() {
        var lat = document.getElementById('lat').value;
        var lng = document.getElementById('lng').value;
        var nome = document.getElementById('poiName').value || "POI";
        if (lat && lng) {
            if (markers[nome]) map.removeLayer(markers[nome]);
            markers[nome] = L.marker([lat, lng]).addTo(map).bindPopup(nome).openPopup();
            map.setView([lat, lng], 15);
        }
    }
</script>
