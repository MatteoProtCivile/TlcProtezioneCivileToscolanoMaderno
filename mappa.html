<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TLC - Protezione Civile Toscolano Maderno</title>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="unpkg.com" crossorigin="anonymous" />
    
    <style>
        html, body { height: 100%; margin: 0; display: flex; flex-direction: column; font-family: sans-serif; }
        
        .pc-header {
            background-color: #003399; color: white; padding: 15px;
            border-bottom: 4px solid #ffcc00; text-align: center; flex-shrink: 0;
        }

        .controls {
            background: white; padding: 10px; display: flex; gap: 8px;
            flex-wrap: wrap; justify-content: center; border-bottom: 1px solid #ccc; flex-shrink: 0;
        }

        input { padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 140px; }
        button { padding: 8px 15px; cursor: pointer; border-radius: 4px; border: none; font-weight: bold; }
        .btn-gps { background-color: #ffcc00; color: #003399; }
        .btn-add { background-color: #003399; color: white; }

        /* Mappa */
        #map { flex-grow: 1; width: 100%; background: #e0e0e0; }

        .pc-footer {
            background-color: #003399; color: white; padding: 10px;
            border-top: 2px solid #ffcc00; text-align: center; font-size: 0.8rem; flex-shrink: 0;
        }
    </style>
</head>
<body>

    <header class="pc-header">
        <strong>PROTEZIONE CIVILE TOSCOLANO MADERNO - REPARTO TLC</strong>
    </header>

    <div class="controls">
        <input type="text" id="nomePunto" placeholder="ID Radio">
        <input type="number" id="lat" placeholder="Latitudine" step="any">
        <input type="number" id="lng" placeholder="Longitudine" step="any">
        <button class="btn-gps" onclick="rilevaPosizione()">üìç GPS</button>
        <button class="btn-add" onclick="aggiungiPunto()">AGGIUNGI</button>
    </div>

    <div id="map"></div>

    <footer class="pc-footer">
        Versione 2025 | Creatore: Matteo Podavini &reg;
    </footer>

    <!-- Leaflet JS -->
    <script src="unpkg.com" crossorigin="anonymous"></script>

    <script>
        // 1. Definizione dei due tipi di mappa
        var stradale = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap'
        });

        var satellite = L.tileLayer('mt1.google.com{x}&y={y}&z={z}', {
            attribution: '&copy; Google Maps'
        });

        // 2. Inizializzazione mappa (parte con stradale)
        var map = L.map('map', {
            center: [45.6415, 10.6083],
            zoom: 13,
            layers: [stradale], // Default
            zoomControl: true
        });

        // 3. Aggiunta selettore in alto a destra per cambiare mappa
        var baseMaps = {
            "Mappa Stradale": stradale,
            "Satellite": satellite
        };
        L.control.layers(baseMaps).addTo(map);

        // Funzione per correggere il problema del grigio al caricamento
        function fixMap() {
            map.invalidateSize();
        }
        window.onload = function() { setTimeout(fixMap, 500); };

        function rilevaPosizione() {
            if (!navigator.geolocation) { alert("GPS non supportato"); return; }
            navigator.geolocation.getCurrentPosition(function(pos) {
                var lt = pos.coords.latitude.toFixed(6);
                var lg = pos.coords.longitude.toFixed(6);
                document.getElementById('lat').value = lt;
                document.getElementById('lng').value = lg;
                map.setView([lt, lg], 16);
                L.marker([lt, lg]).addTo(map).bindPopup("Unit√† TLC").openPopup();
            }, function() { alert("Attiva il GPS."); });
        }

        function aggiungiPunto() {
            var n = document.getElementById('nomePunto').value || "Unit√†";
            var la = parseFloat(document.getElementById('lat').value);
            var lo = parseFloat(document.getElementById('lng').value);
            if (!isNaN(la) && !isNaN(lo)) {
                L.marker([la, lo]).addTo(map).bindPopup(n).openPopup();
                map.flyTo([la, lo], 15);
            }
        }
    </script>
</body>
</html>
